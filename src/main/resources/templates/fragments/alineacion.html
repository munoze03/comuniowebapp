<div th:fragment="alineacionFragment">
    <section class="resume-section" id="alineacion">
        <div class="resume-section-content">
            <h2 class="mb-3">Alineación</h2>

            <div th:if="${alineacion != null}">
                <!-- Selector de táctica -->
                <div class="selector-tactica">
                    <label for="tactica">Elige táctica:</label>
                    <select id="tactica" class="form-select form-select-sm w-auto"
                            onchange="cambiarFormacion(this.value)">
                        <option value="343" th:selected="${alineacion[0].tactic == '343'}">3-4-3</option>
                        <option value="352" th:selected="${alineacion[0].tactic == '352'}">3-5-2</option>
                        <option value="433" th:selected="${alineacion[0].tactic == '433'}">4-3-3</option>
                        <option value="442" th:selected="${alineacion[0].tactic == '442'}">4-4-2</option>
                        <option value="451" th:selected="${alineacion[0].tactic == '451'}">4-5-1</option>
                    </select>
                </div>

                <!-- Cancha -->
                <div class="alineacion-container">
                    <div class="cancha" id="cancha">
                        <!-- Elementos del campo -->
                        <div class="linea-media"></div>
                        <div class="centro-campo"></div>
                        <div class="punto-centro"></div>
                        <div class="area-grande area-grande-top"></div>
                        <div class="area-pequena area-pequena-top"></div>
                        <div class="area-grande area-grande-bottom"></div>
                        <div class="area-pequena area-pequena-bottom"></div>
                    </div>
                </div>

                <!-- Puntos Live 
                <div class="selector-tactica">
                    <label for="livePoints">Puntos Live:</label>
                    <span id="livePoints" style="color: #20c997; font-weight: bold;">0</span>
                </div> -->

                <!-- Boton Guardar nueva alineacion -->
                <form th:action="@{/alineacion/modificar}" method="post" class="mb-2 selector-tactica" id="alineacionForm">
                    <!-- Input oculto para táctica seleccionada -->
                    <input type="hidden" name="tactica" id="inputTactica" th:value="${tacticaSeleccionada}" />
                    <!-- Aquí generas un input oculto para cada jugador alineado -->
                    <div th:each="j, iterStat : ${jugadoresAlineados}">
                        <input type="hidden" th:name="'alineados[' + ${iterStat.index} + '].id'" th:value="${j.id}" />
                        <input type="hidden" th:name="'alineados[' + ${iterStat.index} + '].position'" th:value="${j.position}" />
                        <input type="hidden" th:name="'alineados[' + ${iterStat.index} + '].type'" th:value="${j.type}" />
                        <!-- Puedes añadir más campos si lo necesitas -->
                    </div>
                    <button type="submit" class="btn btn-success selector-tactica">
                        Guardar alineación
                    </button>
                </form> 
            </div>

            <div th:if="${alineacion == null}" class="alert alert-warning">
                No tienes una alineación configurada actualmente.
            </div>
        </div>
    </section>
    <hr class="m-0" />

    <!-- Modal de información del jugador -->
    <div class="modal fade" id="jugadorModal" tabindex="-1" aria-labelledby="jugadorModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="posicion-titulo" id="jugadorModalLabel">Información del jugador</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    
                    <!-- Datos jugador alineado -->
                    <div id="infoJugador">
                        <div class="d-flex align-items-center mb-3">
                            <img id="jugadorFoto" src="" alt="Jugador" class="rounded me-3" width="60">
                            <div>
                            <h6 id="jugadorNombre" class="mb-0"></h6>
                            <small id="jugadorClub" class="text-muted"></small>
                            </div>
                        </div>
                        <p><strong>Posición:</strong> <span id="jugadorPosicion"></span></p>
                        <p><strong>Puntos:</strong> <span id="jugadorPuntos"></span></p>
                        <p><strong>Puntos en vivo:</strong> <span id="jugadorLive"></span></p>
                    </div>

                    <!-- Mensaje para hueco vacío -->
                    <div id="infoVacio" class="text-center my-3 d-none">
                        <p class="text-muted mb-1">No hay jugador en esta posición.</p>
                        <p class="fw-bold text-success">Selecciona uno de tu plantilla:</p>
                    </div>

                    <hr>
                    <h6 class="text-success">Cambiar por:</h6>
                    <div id="jugadoresDisponibles" class="list-group small"></div>
                </div>
            </div>
        </div>
    </div>
    <!-- Inyectamos jugadores desde Thymeleaf en JSON -->
    <script th:inline="javascript">
        window.jugadores = /*[[${alineacion}]]*/ [];
        window.plantilla = /*[[${plantilla}]]*/ [];
    </script>
</div>
